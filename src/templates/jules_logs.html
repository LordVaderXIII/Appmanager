{% extends "layout.html" %}

{% block title %}Jules Logs - App Manager{% endblock %}

{% block content %}
<div class="header-large">
    <h1>Jules Logs</h1>
</div>

<div class="list-group">
    {% for log in logs %}
    <div class="list-item" style="flex-direction: column; align-items: flex-start; gap: 10px; padding: 16px;">
        <div style="width: 100%; display: flex; justify-content: space-between; align-items: center;">
            <div style="font-weight: 600; font-size: 15px;">
                 {% if log.repository %}
                    {{ log.repository.name }}
                 {% else %}
                    Deleted Repo ({{ log.repository_id }})
                 {% endif %}
            </div>
            <div style="color: var(--text-secondary); font-size: 12px;">
                {{ log.timestamp.strftime('%m-%d %H:%M') }}
            </div>
        </div>

        <div style="font-family: monospace; font-size: 12px; color: #ddd; background: var(--bg-tertiary); padding: 8px; border-radius: 6px; width: 100%; box-sizing: border-box; overflow-x: hidden; text-overflow: ellipsis; white-space: nowrap;">
            {{ log.error_message.split('\n')[0] }}
        </div>

        <div style="width: 100%; display: flex; justify-content: space-between; align-items: center; margin-top: 4px;">
            <div style="font-size: 13px; color: var(--text-secondary);">
                Status:
                {% if log.fix_status == 'resolved' %}
                    <span class="status-active">Resolved</span>
                {% elif log.fix_status == 'pr_created' %}
                    <span class="status-building">PR Created</span>
                {% elif log.fix_status == 'reported' %}
                    <span class="status-pending">Analyzing</span>
                {% elif log.fix_status == 'failed' %}
                    <span class="status-error">Failed</span>
                {% else %}
                    {{ log.fix_status|capitalize }}
                {% endif %}
            </div>

            <div style="display: flex; gap: 8px;">
                {% if log.pr_url %}
                <a href="{{ log.pr_url }}" target="_blank" class="btn-secondary small">View PR</a>
                {% endif %}

                {% if log.fix_status != 'resolved' %}
                <form action="/jules/logs/{{ log.id }}/recheck" method="post" style="margin:0;">
                    <button type="submit" class="btn-secondary small" style="color: var(--warning-color);">Recheck</button>
                </form>
                <form action="/jules/logs/{{ log.id }}/ignore" method="post" style="margin:0;">
                    <button type="submit" class="btn-secondary small" style="color: var(--danger-color);">Ignore</button>
                </form>
                {% endif %}
            </div>
        </div>
    </div>
    {% else %}
    <div class="list-item" style="justify-content: center; padding: 30px; color: var(--text-secondary);">
        No history available.
    </div>
    {% endfor %}
</div>
{% endblock %}
